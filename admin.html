<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Administrativo</title>
  <link rel="stylesheet" href="admin.css">
  <script src="https://kit.fontawesome.com/90456d5308.js" crossorigin="anonymous"></script>
</head>
<body>
  <div class="header">
    <h1><strong>Painel</strong> Administrativo</h1>
    <a href="index.html" class="logout">
  <i class="fa-solid fa-right-from-bracket"></i>
  Sair
</a>

  </div>

  <hr>

  <div class="cards-container" id="cardsContainer">
    <div class="card add-card" id="openModal">
      <div class="plus">+</div>
      <div class="title">Adicionar novo item</div>
    </div>
  </div>

  <!-- Modal de cria√ß√£o/edi√ß√£o -->
  <div class="overlay" id="modalOverlay">
    <div class="modal">
      <h2 id="modalTitle">Criar Novo Produto</h2>
      <form id="createForm">
        <label for="itemName">Nome do item</label>
        <input type="text" id="itemName" name="itemName" required>

        <label for="itemDesc">Descri√ß√£o do item</label>
        <textarea id="itemDesc" name="itemDesc" rows="5" required></textarea>

        <label for="itemPrice">Valor</label>
        <input type="number" id="itemPrice" name="itemPrice" step="0.01" required>

        <label for="itemCategory">Categoria</label>
        <select id="itemCategory" name="itemCategory" required>
          <option value="all">Todos</option>
          <option value="geladas">Bebidas Geladas</option>
          <option value="quentes">Bebidas Quentes</option>
          <option value="petiscos">Petiscos</option>
          <option value="pf">Prato Feito</option>
        </select>

        <label for="itemImage">Imagem do item</label>
        <input type="file" id="itemImage" name="itemImage" accept="image/*">

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="cancelBtn">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const openModalBtn = document.getElementById('openModal');
    const overlay = document.getElementById('modalOverlay');
    const cancelBtn = document.getElementById('cancelBtn');
    const form = document.getElementById('createForm');
    const modalTitle = document.getElementById('modalTitle');
    const cardsContainer = document.getElementById('cardsContainer');
    const storageKey = 'productCards';
    let editingIndex = null;

    function renderCards() {
      cardsContainer.innerHTML = '';
      cardsContainer.appendChild(openModalBtn);
      const items = JSON.parse(localStorage.getItem(storageKey) || '[]');
      items.forEach((item, index) => {
        const card = document.createElement('div'); card.className = 'card';
        const img = document.createElement('img'); img.src = item.image; img.alt = item.name;
        const nameEl = document.createElement('div'); nameEl.className = 'item-name'; nameEl.textContent = item.name;
        const descEl = document.createElement('div'); descEl.className = 'item-desc';
        const full = item.desc;
        const limit = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--desc-limit'));
        if (full.length > limit) {
          const preview = full.slice(0, limit) + '...';
          descEl.innerHTML = preview.replace(/\n/g, '<br>');
          const more = document.createElement('span'); more.textContent = 'ler mais'; more.className = 'read-more';
          more.addEventListener('click', () => {
            descEl.innerHTML = full.replace(/\n/g, '<br>'); more.remove();
          });
          descEl.appendChild(more);
        } else {
          descEl.innerHTML = full.replace(/\n/g, '<br>');
        }
        const footer = document.createElement('div'); footer.className = 'footer';
        const priceEl = document.createElement('div'); priceEl.className = 'item-price'; priceEl.textContent = `R$ ${parseFloat(item.price).toFixed(2)}`;
        const actions = document.createElement('div'); actions.className = 'actions';
        const editBtn = document.createElement('button'); editBtn.innerHTML = '&#9998;'; editBtn.title = 'Editar';
        editBtn.addEventListener('click', () => openEditModal(index));
        const deleteBtn = document.createElement('button'); deleteBtn.innerHTML = 'üóëÔ∏è'; deleteBtn.title = 'Excluir';
        deleteBtn.addEventListener('click', () => {
          if (confirm('Deseja realmente excluir este item?')) deleteItem(index);
        });
        actions.appendChild(editBtn); actions.appendChild(deleteBtn);
        footer.appendChild(priceEl); footer.appendChild(actions);
        card.appendChild(img); card.appendChild(nameEl); card.appendChild(descEl); card.appendChild(footer);
        cardsContainer.appendChild(card);
      });
    }

    function openEditModal(index) {
      const items = JSON.parse(localStorage.getItem(storageKey) || '[]');
      const item = items[index];
      editingIndex = index;
      modalTitle.textContent = 'Editar Produto';
      form.itemName.value = item.name;
      form.itemDesc.value = item.desc;
      form.itemPrice.value = item.price;
      form.itemCategory.value = item.category;
      // mant√©m imagem antiga
      overlay.style.display = 'flex';
    }

    function deleteItem(index) {
  const items = JSON.parse(localStorage.getItem(storageKey) || '[]');
  items.splice(index, 1);
  // atualiza os cards no admin‚Ä¶
  localStorage.setItem(storageKey, JSON.stringify(items));
  // ‚Ä¶e tamb√©m sincroniza o index!
  localStorage.setItem('menuItems', JSON.stringify(items));
  renderCards();
}


    form.onsubmit = function(e) {
  e.preventDefault();
  const items = JSON.parse(localStorage.getItem(storageKey) || '[]');
  const oldImage = editingIndex !== null ? items[editingIndex].image : null;

  const name = form.itemName.value;
  const desc = form.itemDesc.value;
  const price = form.itemPrice.value;
  const category = form.itemCategory.value;
  const file = form.itemImage.files[0];

  function saveItem(imageData) {
    const newItem = { name, desc, price, category, image: imageData };
    if (editingIndex !== null) {
      items[editingIndex] = newItem;
    } else {
      items.push(newItem);
    }
    localStorage.setItem(storageKey, JSON.stringify(items));
    localStorage.setItem('menuItems', JSON.stringify(items));
    closeModal();
    renderCards();
  }

  if (file) {
    const reader = new FileReader();
    reader.onload = () => saveItem(reader.result);
    reader.readAsDataURL(file);
  } else {
    // nenhum arquivo novo: reaproveita a imagem antiga
    saveItem(oldImage);
  }
};


    function closeModal() {
      overlay.style.display = 'none'; form.reset(); editingIndex = null; modalTitle.textContent = 'Criar Novo Produto';
    }

    openModalBtn.addEventListener('click', () => { editingIndex = null; modalTitle.textContent = 'Criar Novo Produto'; overlay.style.display = 'flex'; });
    cancelBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', e => { if (e.target === overlay) closeModal(); });

    document.addEventListener('DOMContentLoaded', () => { renderCards(); });
  </script>
</body>
</html>
